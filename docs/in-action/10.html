<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见异常解决方案总结 | YupaiTS的博客</title>
    <meta name="description" content="个人技术博客">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.4568b041.css" as="style"><link rel="preload" href="/assets/js/app.1ceeef9d.js" as="script"><link rel="preload" href="/assets/js/8.5c70aa85.js" as="script"><link rel="prefetch" href="/assets/js/24.20c893ac.js"><link rel="prefetch" href="/assets/js/2.cda51ec0.js"><link rel="prefetch" href="/assets/js/3.988cdff6.js"><link rel="prefetch" href="/assets/js/4.9b90be30.js"><link rel="prefetch" href="/assets/js/5.81f5ddb9.js"><link rel="prefetch" href="/assets/js/6.db8c83e3.js"><link rel="prefetch" href="/assets/js/7.d7d78d24.js"><link rel="prefetch" href="/assets/js/9.68891a98.js"><link rel="prefetch" href="/assets/js/10.911c985c.js"><link rel="prefetch" href="/assets/js/11.4fbda7d9.js"><link rel="prefetch" href="/assets/js/12.ae7f889d.js"><link rel="prefetch" href="/assets/js/13.5ca5825f.js"><link rel="prefetch" href="/assets/js/14.edc23544.js"><link rel="prefetch" href="/assets/js/15.01d1df0b.js"><link rel="prefetch" href="/assets/js/16.37af47e4.js"><link rel="prefetch" href="/assets/js/17.0ab1af8d.js"><link rel="prefetch" href="/assets/js/18.015d176b.js"><link rel="prefetch" href="/assets/js/19.5c01945c.js"><link rel="prefetch" href="/assets/js/20.1e9c831a.js"><link rel="prefetch" href="/assets/js/21.a59403f9.js"><link rel="prefetch" href="/assets/js/22.3e425e5b.js"><link rel="prefetch" href="/assets/js/23.55db1404.js"><link rel="prefetch" href="/assets/js/25.b18d1a7a.js"><link rel="prefetch" href="/assets/js/26.075d1281.js"><link rel="prefetch" href="/assets/js/27.af3dd1c3.js"><link rel="prefetch" href="/assets/js/28.b4870a44.js"><link rel="prefetch" href="/assets/js/29.35abbac0.js"><link rel="prefetch" href="/assets/js/30.f1a391cb.js"><link rel="prefetch" href="/assets/js/31.acbbceee.js"><link rel="prefetch" href="/assets/js/32.1845f5a3.js"><link rel="prefetch" href="/assets/js/33.5cfe5e20.js"><link rel="prefetch" href="/assets/js/34.3698065a.js"><link rel="prefetch" href="/assets/js/35.da519351.js"><link rel="prefetch" href="/assets/js/36.def103cc.js"><link rel="prefetch" href="/assets/js/37.efbf2bdc.js"><link rel="prefetch" href="/assets/js/38.4607a034.js"><link rel="prefetch" href="/assets/js/39.c7be3454.js"><link rel="prefetch" href="/assets/js/40.2f61a8a6.js"><link rel="prefetch" href="/assets/js/41.f1914e27.js"><link rel="prefetch" href="/assets/js/42.f3820d42.js"><link rel="prefetch" href="/assets/js/43.9085fc7e.js"><link rel="prefetch" href="/assets/js/44.4652d519.js"><link rel="prefetch" href="/assets/js/45.2ce37979.js"><link rel="prefetch" href="/assets/js/46.e71e1db8.js"><link rel="prefetch" href="/assets/js/47.6f141096.js"><link rel="prefetch" href="/assets/js/48.e8d962e0.js"><link rel="prefetch" href="/assets/js/49.83abc5df.js"><link rel="prefetch" href="/assets/js/50.ab808cd9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4568b041.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YupaiTS的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/5.html" class="nav-link">String.format的用法</a></li><li class="dropdown-item"><!----> <a href="/java/4.html" class="nav-link">Java集合杂谈</a></li><li class="dropdown-item"><!----> <a href="/java/3.html" class="nav-link">Java运算符instanceof的用法</a></li><li class="dropdown-item"><!----> <a href="/java/2.html" class="nav-link">Java枚举类实例</a></li><li class="dropdown-item"><!----> <a href="/java/1.html" class="nav-link">Java递归的实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列专题</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/spring-cloud/" class="nav-link">基于Spring Cloud快速搭建微服务</a></li><li class="dropdown-item"><!----> <a href="/topics/docker/" class="nav-link">Docker入门攻略</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops-deploy/8.html" class="nav-link">GitLab-CI环境搭建与SpringBoot项目CI配置总结</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/7.html" class="nav-link">使用Gitee+Jenkins+Docker完成前后端分离项目的CI/CD</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/6.html" class="nav-link">使用GitHub和Jenkins自动构建并部署静态页面</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/5.html" class="nav-link">通过开启swap分区解决小内存阿里云服务器的运行瓶颈</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/4.html" class="nav-link">Linux常用指令</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/3.html" class="nav-link">RabbitMQ安装部署及常见问题</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/2.html" class="nav-link">阿里云服务器环境搭建</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/1.html" class="nav-link">阿里云Linux服务器格式化和挂载数据盘</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实用工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/5.html" class="nav-link">Linux下安装Confluence</a></li><li class="dropdown-item"><!----> <a href="/tools/4.html" class="nav-link">Markdown语法</a></li><li class="dropdown-item"><!----> <a href="/tools/3.html" class="nav-link">cron语法简单总结</a></li><li class="dropdown-item"><!----> <a href="/tools/2.html" class="nav-link">使用hexo快速搭建个人博客</a></li><li class="dropdown-item"><!----> <a href="/tools/1.html" class="nav-link">搭建 GitLab 私有代码托管</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实战总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/in-action/10.html" class="nav-link router-link-exact-active router-link-active">常见异常解决方案总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/9.html" class="nav-link">开发实战总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/8.html" class="nav-link">GitLab使用手册</a></li><li class="dropdown-item"><!----> <a href="/in-action/7.html" class="nav-link">SpringBoot和Vue单页面前后端分离项目的整合与构建</a></li><li class="dropdown-item"><!----> <a href="/in-action/6.html" class="nav-link">Git分支管理</a></li><li class="dropdown-item"><!----> <a href="/in-action/5.html" class="nav-link">从Ultimate-Spider全方位解析数据采集系统的基本知识</a></li><li class="dropdown-item"><!----> <a href="/in-action/4.html" class="nav-link">开源项目License的介绍</a></li><li class="dropdown-item"><!----> <a href="/in-action/3.html" class="nav-link">Todo-Tomato技术解读</a></li><li class="dropdown-item"><!----> <a href="/in-action/2.html" class="nav-link">微信公众号管理平台的实现</a></li><li class="dropdown-item"><!----> <a href="/in-action/1.html" class="nav-link">weixin-java-tools微信JavaSDK开发工具包</a></li></ul></div></div><div class="nav-item"><a href="/books.html" class="nav-link">阅读书单</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/YupaiTS/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/5.html" class="nav-link">String.format的用法</a></li><li class="dropdown-item"><!----> <a href="/java/4.html" class="nav-link">Java集合杂谈</a></li><li class="dropdown-item"><!----> <a href="/java/3.html" class="nav-link">Java运算符instanceof的用法</a></li><li class="dropdown-item"><!----> <a href="/java/2.html" class="nav-link">Java枚举类实例</a></li><li class="dropdown-item"><!----> <a href="/java/1.html" class="nav-link">Java递归的实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列专题</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/spring-cloud/" class="nav-link">基于Spring Cloud快速搭建微服务</a></li><li class="dropdown-item"><!----> <a href="/topics/docker/" class="nav-link">Docker入门攻略</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops-deploy/8.html" class="nav-link">GitLab-CI环境搭建与SpringBoot项目CI配置总结</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/7.html" class="nav-link">使用Gitee+Jenkins+Docker完成前后端分离项目的CI/CD</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/6.html" class="nav-link">使用GitHub和Jenkins自动构建并部署静态页面</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/5.html" class="nav-link">通过开启swap分区解决小内存阿里云服务器的运行瓶颈</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/4.html" class="nav-link">Linux常用指令</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/3.html" class="nav-link">RabbitMQ安装部署及常见问题</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/2.html" class="nav-link">阿里云服务器环境搭建</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/1.html" class="nav-link">阿里云Linux服务器格式化和挂载数据盘</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实用工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/5.html" class="nav-link">Linux下安装Confluence</a></li><li class="dropdown-item"><!----> <a href="/tools/4.html" class="nav-link">Markdown语法</a></li><li class="dropdown-item"><!----> <a href="/tools/3.html" class="nav-link">cron语法简单总结</a></li><li class="dropdown-item"><!----> <a href="/tools/2.html" class="nav-link">使用hexo快速搭建个人博客</a></li><li class="dropdown-item"><!----> <a href="/tools/1.html" class="nav-link">搭建 GitLab 私有代码托管</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实战总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/in-action/10.html" class="nav-link router-link-exact-active router-link-active">常见异常解决方案总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/9.html" class="nav-link">开发实战总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/8.html" class="nav-link">GitLab使用手册</a></li><li class="dropdown-item"><!----> <a href="/in-action/7.html" class="nav-link">SpringBoot和Vue单页面前后端分离项目的整合与构建</a></li><li class="dropdown-item"><!----> <a href="/in-action/6.html" class="nav-link">Git分支管理</a></li><li class="dropdown-item"><!----> <a href="/in-action/5.html" class="nav-link">从Ultimate-Spider全方位解析数据采集系统的基本知识</a></li><li class="dropdown-item"><!----> <a href="/in-action/4.html" class="nav-link">开源项目License的介绍</a></li><li class="dropdown-item"><!----> <a href="/in-action/3.html" class="nav-link">Todo-Tomato技术解读</a></li><li class="dropdown-item"><!----> <a href="/in-action/2.html" class="nav-link">微信公众号管理平台的实现</a></li><li class="dropdown-item"><!----> <a href="/in-action/1.html" class="nav-link">weixin-java-tools微信JavaSDK开发工具包</a></li></ul></div></div><div class="nav-item"><a href="/books.html" class="nav-link">阅读书单</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/YupaiTS/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>常见异常解决方案总结</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/in-action/10.html#java-spring" class="sidebar-link">Java/Spring</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="常见异常解决方案总结"><a href="#常见异常解决方案总结" aria-hidden="true" class="header-anchor">#</a> 常见异常解决方案总结</h1> <h2 id="java-spring"><a href="#java-spring" aria-hidden="true" class="header-anchor">#</a> Java/Spring</h2> <ol><li><p><code>Caused by: com.alibaba.fastjson.JSONException: default constructor not found.</code></p> <ul><li>解决方案：解析的目标类增加无参构造方法。</li></ul></li> <li><p>使用 <code>frontend-maven-plugin</code> 进行maven打包时出现以下错误：</p> <p><code>Failed to execute goal com.github.eirslett:frontend-maven-plugin:1.6:install-node-and-npm (install node and npm) on project spider-web: Could not extract the npm archive: Could not extract archive: 'C:\Users\xxx\.m2\repository\com\github\eirslett\npm\5.7.1\npm-5.7.1.tar.gz': EOFException</code></p> <ul><li>解决方案：把./m2目录下载不完全的包清掉之后再执行打包。</li></ul></li> <li><p>Apache工具类方法FileUtils.forceDelete(File file)报 <code>java.io.IOException: Unable to delete file:</code> 错误。</p> <ul><li>解决方案：检查file的路径是否是绝对路径，相对路径有可能会出问题。</li></ul></li> <li><p><code>sudo: no tty present and no askpass program specified</code></p> <ul><li>解决方案：设置指定用户（如 gitlab-runner）使用sudo命令不需要手动输入登录密码。<div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/sudoers
gitlab-runner ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p>Spring Cloud架构下微服务使用 <code>@EnableJpaAuditing</code> 开启审计功能时，需要调用方服务依赖 <code>spring-aspects.jar</code> 包，否则在使用RestTemplate进行服务间调用时会报如下错误：
<code>o.s.s.o.provider.endpoint.TokenEndpoint : Handling error: InternalAuthenticationServiceException, sun.reflect.annotation.TypeNotPresentExceptionProxy</code></p> <ul><li><p>解决方案：通过在TypeNotPresentExceptionProxy类的构造方法中打断点，发现根本原因是：
<code>java.lang.NoClassDefFoundError: org/springframework/beans/factory/aspectj/ConfigurableObject</code></p> <p>而该类是存在于spring-aspects包中，最终通过添加该依赖解决问题。</p></li></ul></li> <li><p>JPA事务管理踩坑：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>If you retrieve an entity, for example using the findOne method call within a transactional method it has become managed from that point by the persistence provider.
Now if you make any changes to that entity (which is actually a proxy object), upon transaction commit, those changes will be persisted to the database, regardless of the fact of invoking the save or update methods.
save or persist has to be used when you are creating a new entity from scratch and persistence provider does not know of its existance yet.
Remember that you can prevent making any changes upon commit, if you use detach or evict methods on that particular entity before those changes occur.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>翻译：如果您检索实体，例如findOne在事务方法中使用方法调用，则由持久性提供程序从那时起管理它。现在，如果对该实体（实际上是代理对象）进行任何更改，则在事务提交时，无论调用save或update方法的事实如何，这些更改都将持久保存到数据库。save或者persist必须在从头开始创建新实体时使用，并且持久性提供程序还不知道它的存在。请记住，如果在发生更改之前在特定实体上使用detach或使用evict方法，则可以阻止在提交时进行任何更改。</p></li> <li><p>解决方案：简而言之，就是在save通过findxxxByxxx查询得到的对象的时候，如果有spring的事务进行控制时，需要new一个同类型的对象再去save。</p></li> <li><p>参考：<a href="https://stackoverflow.com/questions/46708063/springboot-jpa-need-no-save-on-transactional" target="_blank" rel="noopener noreferrer">SpringBoot JPA need no .save() on @Transactional?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></li> <li><p>Logback使用AmqpAppender的json格式日志向elk打印日志时，如果使用%ex会因为异常堆栈信息中包含为转义的\t\n等字符导致logstash的json解析失败，从而使得日志中无法记录堆栈信息。</p> <ul><li>解决思路：
<ol><li>logstash的input直接使用 <code>codec =&gt; plain</code> 解析，此方式适用于 <code>AmqpAppender</code> 的 <code>pattern</code> 格式为字符串日志而不是类json格式日志</li> <li>pattern中使用 <code>%replace</code> 对 <code>%ex</code> 中的 <code>\t\n</code> 等字符进行转义替换</li></ol></li></ul></li></ol></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/YupaiTS/yupaits.github.io/edit/master/post/in-action/10.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">8/15/2018, 2:27:29 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/8.5c70aa85.js" defer></script><script src="/assets/js/app.1ceeef9d.js" defer></script>
  </body>
</html>
